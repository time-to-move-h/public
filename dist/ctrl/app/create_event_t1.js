"use strict";requirejs(["jquery","parsley","jqsobject","c/datepicker/js/datepicker","places","app/modules/Generic","app/modules/Event","app/modules/Channel","app/modules/Profile","toastr","app/modules/textEditor","app/modules/formSection"],(function($,parsley,jqsobject,datepicker,places,Generic,Event,Channel,Profile,toastr,textEditor,formSection){var self=this,generic=new Generic,event=new Event,channel=new Channel,profile=new Profile,section=new formSection,editor=new textEditor,create_evt={$select_channels:$("#channels"),$select_tags:$("#tags"),selchannel:"selchannel",datepicker_start:null,datepicker_end:null,lang:$("html").closest("[lang]").attr("lang")||"en",init:function(){requirejs(["parsley/"+create_evt.lang],(function(parsley_lang){$(document).on("submit","#formEventBusiness",(function(e){try{var instance;if($("#error_unknown").css("display","none"),$("#error_unknown").css("visibility","hidden"),!$("#formEventBusiness").parsley().isValid())return;var jsonObj=$("#formEventBusiness").serializeJSON();if(0===Object.keys(jsonObj).length)return;$("#btnSave").prop("disabled",!0),$("#btnSave > span").show(),profile.saveBusinessInformation(self,create_evt.onSaveBusinessInformation,jsonObj)}finally{e.preventDefault()}}))})),document.getElementById("formEvent")&&($(document).on("submit","#formEvent",(function(e){try{var instance;if($("#error_unknown").css("display","none"),$("#error_unknown").css("visibility","hidden"),!$("#formEvent").parsley().isValid())return;var jsonObj=$("#formEvent").serializeJSON(),data_descl=$(".ql-editor").html();if(jsonObj.DESCL=data_descl,0===Object.keys(jsonObj).length)return;$("#btnPublish").prop("disabled",!0),event.createEvent(self,create_evt.onCreateEvent,jsonObj)}finally{e.preventDefault()}})),requirejs(["c/datepicker/js/i18n/datepicker."+create_evt.lang],(function(datepicker_lang){create_evt.datepicker_start=create_evt.initStartCalendar(!1),create_evt.datepicker_end=create_evt.initEndCalendar(!1),$("#allday").change((function(){var c=!!this.checked;create_evt.datepicker_start.destroy(),create_evt.datepicker_end.destroy(),create_evt.datepicker_start=create_evt.initStartCalendar(c),create_evt.datepicker_end=create_evt.initEndCalendar(c)}))})),$((function(){section.init(create_evt.before_navigate,create_evt.after_navigate),section.navigateTo(0),editor.init("#EVTDESC"),channel.getChannelsCombo(self,create_evt.onLoadChannelsCombo,null);var jsonObj={L:create_evt.lang};generic.loadAllTags(self,(function(self,model){null!==model&&!0===model.result&&$.each(model.data,(function(){create_evt.$select_tags.append('<option value="'+this.value+'">'+this.text+"</option>")}))}),jsonObj)})))},getDateNowPicker:function(){var now=new Date;return now.setHours(now.getHours()+2),now.setMinutes(0),now.setSeconds(0),now.setMilliseconds(0),now},initStartCalendar:function(allday){return $("#start_date").datepicker({timepicker:!allday,language:create_evt.lang,startDate:create_evt.getDateNowPicker(),minDate:create_evt.getDateNowPicker(),minutesStep:5,altField:"#start_date_formatted",altFieldDateFormat:"yyyy-mm-dd hh:ii",clearButton:!0,autoClose:!1,onSelect:function onSelect(fd,date){create_evt.datepicker_end.update("minDate",date)}}).data("datepicker")},initEndCalendar:function(allday){return $("#end_date").datepicker({timepicker:!allday,language:create_evt.lang,startDate:create_evt.getDateNowPicker(),minDate:create_evt.getDateNowPicker(),minutesStep:5,altField:"#end_date_formatted",altFieldDateFormat:"yyyy-mm-dd hh:ii",clearButton:!0,autoClose:!1,onSelect:function onSelect(fd,date){create_evt.datepicker_start.update("maxDate",date)}}).data("datepicker")},onLoadChannelsCombo:function(self,model){if(null!==model&&!0===model.result){var selectedChannel=document.getElementById(create_evt.selchannel).value;$.each(model.data,(function(){selectedChannel==this.NAME?create_evt.$select_channels.append('<option value="'+this.NAME+'" selected>'+this.TITLE+"</option>"):create_evt.$select_channels.append('<option value="'+this.NAME+'">'+this.TITLE+"</option>")}))}},onLoadTags:function(self,model){if(null!==model&&!0===model.result){$("#tags_list").empty();var tmpl=$("#tpl_tags").html(),tempFn=doT.template(tmpl);$.each(model.data,(function(){var resultText=tempFn({value:this.value,text:this.text});$("#tags_list").append(resultText)}));var $select=$("#tags");$select.find("option").remove(),$.each(model.data,(function(){$select.append('<option value="'+this.value+'">'+this.text+"</option>")}))}},event_redirect:function(urllink){var url="/event/";setTimeout((function(){window.location.href=url+urllink}),500)},onCreateEvent:function(self,model){null!==model&&!0===model.result?create_evt.event_redirect(model.urllink):($("#btnPublish").prop("disabled",!1),$("#error_unknown").css("display","block"),$("#error_unknown").css("visibility","visible"))},onSaveBusinessInformation:function(self,model){null!==model&&!0===model.result?location.reload():null!==model&&!1===model.result&&93847584===model.code?($("#btnSave").prop("disabled",!1),$("#btnSave > span").hide(),$("#error_vat_notfound").css("display","block"),$("#error_vat_notfound").css("visibility","visible")):($("#btnSave").prop("disabled",!1),$("#btnSave > span").hide(),$("#error_unknown").css("display","block"),$("#error_unknown").css("visibility","visible"))},before_navigate:function(index){0!==index||$(".ql-editor").html()},after_navigate:function(index){}};create_evt.init()}));