"use strict";requirejs(["jquery","parsley","parsley/fr","jqsobject","jquery.loading","app/modules/Profile"],(function($,parsley,parsley_lang,jqsobject,jqloading,Profile){var login={$panel_pwd:"pwd_panel",$input_pwd_type:"pwd_type",$input_pwd:"pwd",$input_account:"account",$error_unknown:"error_unknown",$error_account_disabled:"error_account_disabled",$label_pwd_otp:"lbl_pwd_otp",$label_pwd:"lbl_pwd",profile:null,$form_frecover:"#frecover",panel_success:"sub_success",panel_failed:"sub_failed",panel_account:"sub_account",init:function(){this.profile=new Profile,$("#RForm").on("shown.bs.modal",(function(){$("#raccount").focus()})),document.getElementById("fsignin").onsubmit=function(){try{login.onSubmitForm()}catch(e){}finally{return!1}},document.getElementById("btn_fb").onclick=function(){try{login.onsubmitFB()}catch(e){}};var txt_input=document.getElementById(this.$input_account);txt_input.addEventListener("change",(function(){""===txt_input.value&&(document.getElementById(login.$input_pwd).value="",document.getElementById(login.$panel_pwd).style.visibility="hidden",document.getElementById(login.$panel_pwd).style.display="none",login.hideError(),txt_input.focus())})),$(document).on("submit",login.$form_frecover,login.onSubmitFormRecover)},initFB:function(){var d,s,id,js,fjs;window.fbAsyncInit=function(){FB.init({appId:"867246163456148",cookie:!0,xfbml:!1,version:"v13.0"})},d=document,s="script",id="facebook-jssdk",fjs=d.getElementsByTagName(s)[0],d.getElementById(id)||((js=d.createElement(s)).id=id,js.src="https://connect.facebook.net/en_US/sdk.js",fjs.parentNode.insertBefore(js,fjs))},initGG:function(){try{google.accounts.id.initialize({client_id:"901321113948-afpee2ivmq2vkejf1b4t59iai6b8vcc8.apps.googleusercontent.com",callback:login.onsubmitGG}),google.accounts.id.renderButton(document.getElementById("btn_gg"),{theme:"filled_black",size:"large",width:"373"})}catch(e){console.log(e)}},onLoginP1:function(jsonObj){try{this.disableBtn(),this.profile.login_p1(this,(function(self,model){null!==model&&!0===model.result?(document.getElementById(self.$input_pwd_type).value=model.pwd_type,"1"===model.pwd_type?(document.getElementById(self.$label_pwd_otp).style.visibility="visible",document.getElementById(self.$label_pwd_otp).style.display="block",document.getElementById(self.$label_pwd).style.visibility="hidden",document.getElementById(self.$label_pwd).style.display="none"):(document.getElementById(self.$label_pwd_otp).style.visibility="hidden",document.getElementById(self.$label_pwd_otp).style.display="none",document.getElementById(self.$label_pwd).style.visibility="visible",document.getElementById(self.$label_pwd).style.display="block"),document.getElementById(self.$input_pwd).disabled=!1,document.getElementById(self.$panel_pwd).style.visibility="visible",document.getElementById(self.$panel_pwd).style.display="block",document.getElementById(self.$input_pwd).focus()):self.showError(),self.enableBtn()}),jsonObj)}catch(e){self.enableBtn(),console.log(e)}},onLoginP2:function(jsonObj){try{this.disableBtn(),this.profile.login_p2(this,(function(self,model){null!==model&&!0===model.result?self.wall_redirect():null!==model.code?(self.enableBtn(),self.showError(model.code)):(self.enableBtn(),self.showError(null))}),jsonObj)}catch(e){self.enableBtn(),console.log(e)}},wall_redirect:function(){var surl="/home";window.location.href=surl},onSubmitForm:function(){try{var instance;if(this.hideError(),!$("#fsignin").parsley().isValid())return;var jsonObj=$("#fsignin").serializeJSON(),step_pwd;"visible"===document.getElementById(this.$panel_pwd).style.visibility&&jsonObj.PWD?this.onLoginP2(jsonObj):this.onLoginP1(jsonObj)}catch(e){}},onSubmitFormRecover:function(e){try{var instance;if(e.stopPropagation(),e.preventDefault(),!$("#frecover").parsley().isValid())return;var jsonObj=$("#frecover").serializeJSON();jsonObj.account&&login.onRecover(jsonObj)}catch(e){console.log(e)}},onRecover:function(jsonObj){try{login.profile.recoverPwd(this,(function(self,model){null!==model&&!0===model.result?(document.getElementById(self.panel_failed).style.visibility="hidden",document.getElementById(self.panel_failed).style.display="none",document.getElementById(self.panel_success).style.visibility="visible",document.getElementById(self.panel_success).style.display="block",document.getElementById(self.panel_account).style.display="none",document.getElementById("btn_frecover").style.display="none"):(document.getElementById(self.panel_failed).style.visibility="visible",document.getElementById(self.panel_failed).style.display="block")}),jsonObj)}catch(e){console.log(e)}},disableBtn:function(){document.getElementById("btn_fb").disabled=!0,document.getElementById("bsubmit").disabled=!0,$("#bsubmit > span").show()},enableBtn:function(){document.getElementById("btn_fb").disabled=!1,document.getElementById("bsubmit").disabled=!1,$("#bsubmit > span").hide()},showError:function(code){"7200550933"==code?(document.getElementById(this.$error_account_disabled).style.visibility="visible",document.getElementById(this.$error_account_disabled).style.display="block"):(document.getElementById(this.$error_unknown).style.visibility="visible",document.getElementById(this.$error_unknown).style.display="block")},hideError:function(){document.getElementById(this.$error_unknown).style.visibility="hidden",document.getElementById(this.$error_unknown).style.display="none"},onsubmitFB:function(){try{this.disableBtn(),FB.getLoginStatus((function(response){if("connected"===response.status)try{login.loginFacebook()}catch(e){console.log(e)}else FB.login((function(response){if(response.authResponse)try{login.loginFacebook()}catch(e){console.log(e)}else this.enableBtn()}))}))}catch(e){}finally{setTimeout(enableBtn,15e3)}},loginFacebook:function(){try{var jsonObj={};this.profile.login_fb(this,(function(self,model){if(null!==model&&!0===model.result){var surl="/home";window.location.href=surl}else self.enableBtn()}),jsonObj)}catch(e){console.log(e)}},loginGoogle:function(response){try{var jsonObj={token:response.credential};this.profile.login_gg(this,(function(self,model){if(null!==model&&!0===model.result){var surl="/home";window.location.href=surl}else self.enableBtn()}),jsonObj)}catch(e){console.log(e)}},onsubmitGG:function(response){try{login.loginGoogle(response)}catch(e){console.log(e)}}};login.init(),login.initFB(),login.initGG()}));