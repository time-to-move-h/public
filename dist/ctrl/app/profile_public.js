"use strict";requirejs(["jquery","tippy","moment","moment/fr","toastr","doT","flow","app/modules/Event","app/modules/Channel","app/modules/Ticket","app/modules/Utils","app/modules/CropImage","c/tingle/tingle.min"],(function($,tippy,Moment,Moment_lang,toastr,doT,Flow,Event,Channel,Ticket,Utils,CropImage,tingle){var event=new Event,channel=new Channel,ticket=new Ticket,utils=new Utils,profile={btn_edit_background:"btn_edit_background",btn_edit_avatar:"btn_edit_avatar",token:0,btn_channel_view_panel:"btn_channel_view_panel",btn_ticket_view_panel:"btn_ticket_view_panel",btn_event_view_panel:"btn_event_view_panel",event_view_panel:"event_view_panel",list_upcoming_events_id:"list_upcoming_events",list_upcoming_events:"list_upcoming_events",event_view_panel_empty:"event_view_panel_empty",btn_loadmore_upcoming_events_id:"btn_loadmore_upcoming_events",panel_loadmore_upcoming_events:"panel_loadmore_upcoming_events",btn_loadmore_upcoming_events:"btn_loadmore_upcoming_events",list_upcoming_past_events_id:"list_upcoming_past_events",panel_loadmore_upcoming_past_events:"panel_loadmore_upcoming_past_events",btn_loadmore_upcoming_past_events:"btn_loadmore_upcoming_past_events",event_past_view_panel_empty:"event_past_view_panel_empty",list_upcoming_past_events:"list_upcoming_past_events",channel_view_panel:"channel_view_panel",list_upcoming_channels_id:"list_upcoming_channels",list_upcoming_channels:"list_upcoming_channels",channel_view_panel_empty:"channel_view_panel_empty",panel_loadmore_upcoming_channels:"panel_loadmore_upcoming_channels",btn_loadmore_upcoming_channels:"btn_loadmore_upcoming_channels",tpl_channel_calendar:"tpl_channel_calendar",panel_loadmore_upcoming_tickets:"panel_loadmore_upcoming_tickets",ticket_view_panel:"ticket_view_panel",list_upcoming_tickets_id:"list_upcoming_tickets",list_upcoming_tickets:"list_upcoming_tickets",ticket_view_panel_empty:"ticket_view_panel_empty",btn_loadmore_upcoming_tickets:"btn_loadmore_upcoming_tickets",text_nopublished:document.getElementById("text_nopublished").innerHTML,firstLoad_events:!0,firstLoadPastEvents:!0,firstLoad_channels:!0,firstLoad_tickets:!0,offset_events:0,offsetPastEvents:0,offset_channels:0,lang:$("html").closest("[lang]").attr("lang")||"en",init:function(){channel.getChannels(this,this.onLoadChannels,{O:this.offset_channels})},onOpenModalEditImage:function(e){profile.token=$(e.target).attr("data-token"),profile.modal_img.open(),e.stopPropagation(),e.preventDefault()},onClickEventView:function(e){return e.stopPropagation(),e.preventDefault(),document.getElementById(profile.event_view_panel).style.display="block",document.getElementById(profile.channel_view_panel).style.display="none",document.getElementById(profile.ticket_view_panel).style.display="none",$("#"+profile.btn_event_view_panel).addClass("active"),$("#"+profile.btn_channel_view_panel).removeClass("active"),$("#"+profile.btn_ticket_view_panel).removeClass("active"),profile.updateHashTagUrl("events"),!1},onClickChannelView:function(e){return e.stopPropagation(),e.preventDefault(),document.getElementById(profile.channel_view_panel).style.display="block",document.getElementById(profile.event_view_panel).style.display="none",document.getElementById(profile.ticket_view_panel).style.display="none",$("#"+profile.btn_channel_view_panel).addClass("active"),$("#"+profile.btn_event_view_panel).removeClass("active"),$("#"+profile.btn_ticket_view_panel).removeClass("active"),profile.updateHashTagUrl("channels"),!1},onClickTicketView:function(e){return e.stopPropagation(),e.preventDefault(),document.getElementById(profile.ticket_view_panel).style.display="block",document.getElementById(profile.event_view_panel).style.display="none",document.getElementById(profile.channel_view_panel).style.display="none",$("#"+profile.btn_ticket_view_panel).addClass("active"),$("#"+profile.btn_channel_view_panel).removeClass("active"),$("#"+profile.btn_event_view_panel).removeClass("active"),profile.updateHashTagUrl("tickets"),!1},initImage:function(){profile.modal_img=new tingle.modal({footer:!0,stickyFooter:!1,closeMethods:["overlay","button","escape"],closeLabel:"Close",cssClass:["custom"],onOpen:function(){var options_background={enableExif:!0,enableZoom:!0,showZoomer:!1,viewport:{width:851,height:315},boundary:{width:851,height:315}},options_avatar={enableExif:!0,enableZoom:!0,showZoomer:!1,viewport:{width:128,height:128},boundary:{width:300,height:300}},upload_token="8247",cropimage=new CropImage;cropimage.setOptions(options_background),cropimage.setUid(profile.getUID()),cropimage.setUploadToken("8247"),cropimage.setUploadCropZone($("#upload-demo")),$("#upload").on("change",(function(){var result;!0===cropimage.readFile(this)&&$("#upload_btn_save").css("visibility","visible")})),cropimage.setCallBack((function(message){var msg=JSON.parse(message);if(!0===msg.success){var t=msg.post.upload_token;"8247"===t?document.getElementById("back_img").src=msg.flowIdentifier:"9787"===t&&(document.getElementById("user_img").src=msg.flowIdentifier),$("#upload_btn_save").css("visibility","hidden"),profile.modal_img.close()}})),$(".upload-result").on("click",(function(e){cropimage.crop()})),"8247"===profile.token?cropimage.setOptions(options_background):"9787"===profile.token&&cropimage.setOptions(options_avatar),$("#upload_btn_save").css("visibility","hidden"),cropimage.setUploadCropZone($("#upload-demo")),cropimage.setUploadToken(profile.token)},onClose:function(){},beforeClose:function(){return!0}}),profile.modal_img.setContent(document.getElementById("panel_edit_img").innerHTML)},getUID:function(){return utils.getValueByID("uid")},isEventData:function(){return document.getElementById(profile.list_upcoming_events_id).innerHTML.length},isPastEventData:function(){return document.getElementById(profile.list_upcoming_past_events_id).innerHTML.length},onLoadEvents:function(self,model){if(null!==model&&!0===model.result)if(model.data.length>0){!0===self.firstLoad_events&&(model.data.length<9?profile.hideLoadmoreUpcoming():profile.showLoadmoreUpcoming()),document.getElementById(profile.event_view_panel_empty).style.display="none";var tmpl=document.getElementById("tpl_evt").innerHTML,tempFn=doT.template(tmpl);$.each(model.data,(function(){var a=Moment(this.DATBEG);a.locale(profile.lang);var t=this.TITLE;"0"===this.ONLINE&&(t+='&nbsp;&nbsp;&nbsp;<span class="tag badge badge-warning">'+profile.text_nopublished+"</span>");var resultText=tempFn({TITLE:t,DATBEG:a.locale("fr").format("dddd, DD MMMM YYYY HH:mm"),DAY:a.format("DD"),MONTH:a.format("MMMM"),SUBSCRIPTION:this.SUBSCRIPTION,URLLINK:this.URLLINK});$("#"+profile.list_upcoming_events).append(resultText)}))}else profile.hideLoadmoreUpcoming(),profile.isEventData()<=0&&(document.getElementById(profile.event_view_panel_empty).style.display="block")},hideLoadmoreUpcoming:function(){document.getElementById(profile.panel_loadmore_upcoming_events).style.display="none"},showLoadmoreUpcoming:function(){document.getElementById(profile.panel_loadmore_upcoming_events).style.display="block"},onLoadPastEvents:function(self,model){if(null!==model&&!0===model.result)if(model.data.length>0){!0===profile.firstLoadPastEvents&&(model.data.length<9?profile.hideLoadmorePastUpcoming():profile.showLoadmorePastUpcoming()),document.getElementById(profile.event_past_view_panel_empty).style.display="none";var tmpl=document.getElementById("tpl_evt").innerHTML,tempFn=doT.template(tmpl);$.each(model.data,(function(){var a=Moment(this.DATBEG);a.locale(profile.lang);var t=this.TITLE;"0"===this.ONLINE&&(t+='&nbsp;&nbsp;&nbsp;<span class="tag badge badge-warning">'+profile.text_nopublished+"</span>");var resultText=tempFn({TITLE:t,DATBEG:a.locale("fr").format("dddd, DD MMMM YYYY HH:mm"),DAY:a.format("DD"),MONTH:a.format("MMMM"),SUBSCRIPTION:this.SUBSCRIPTION,URLLINK:this.URLLINK});$("#"+profile.list_upcoming_past_events).append(resultText)})),!1===profile.firstLoadPastEvents&&window.scrollTo(0,document.body.scrollHeight)}else profile.hideLoadmorePastUpcoming(),profile.isPastEventData()<=0&&(document.getElementById(profile.event_past_view_panel_empty).style.display="block")},hideLoadmorePastUpcoming:function(){document.getElementById(profile.panel_loadmore_upcoming_past_events).style.display="none"},showLoadmorePastUpcoming:function(){document.getElementById(profile.panel_loadmore_upcoming_past_events).style.display="block"},isChannelData:function(){return document.getElementById(profile.list_upcoming_channels_id).innerHTML.length},istTicketData:function(){return document.getElementById(profile.list_upcoming_tickets_id).innerHTML.length},onLoadChannels:function(self,model){if(null!==model&&!0===model.result)if(model.data.length>0){!0===profile.firstLoad_channels&&(model.data.length<9?profile.hideLoadmoreChannelUpcoming():profile.showLoadmoreChannelUpcoming()),document.getElementById(profile.channel_view_panel_empty).style.display="none";var tmpl=document.getElementById(profile.tpl_channel_calendar).innerHTML,tempFn=doT.template(tmpl);$.each(model.data,(function(){var t=this.TITLE;"0"===this.ONLINE&&(t+='&nbsp;&nbsp;&nbsp;<span class="tag badge badge-warning">'+profile.text_nopublished+"</span>");var resultText=tempFn({TITLE:t,NAME:this.NAME,DESCL:this.DESCL});$("#"+profile.list_upcoming_channels).append(resultText)})),!1===profile.firstLoad_channels&&window.scrollTo(0,document.body.scrollHeight)}else profile.hideLoadmoreChannelUpcoming(),profile.isChannelData()<=0&&(document.getElementById(profile.channel_view_panel_empty).style.display="block")},hideLoadmoreChannelUpcoming:function(){null!=document.getElementById(profile.panel_loadmore_upcoming_channels)&&(document.getElementById(profile.panel_loadmore_upcoming_channels).style.display="none")},showLoadmoreChannelUpcoming:function(){null!=document.getElementById(profile.panel_loadmore_upcoming_channels)&&(document.getElementById(profile.panel_loadmore_upcoming_channels).style.display="block")},onLoadTickets:function(self,model){if(null!==model&&!0===model.result)if(model.data.length>0){!0===self.firstLoad_tickets&&(model.data.length<9?profile.hideLoadmoreTicketUpcoming():profile.showLoadmoreTicketUpcoming()),document.getElementById(profile.ticket_view_panel_empty).style.display="none";var tmpl=document.getElementById("tpl_mytickets").innerHTML,tempFn=doT.template(tmpl);$.each(model.data,(function(){var resultText=tempFn({TICORDER:this.TICORDER,TITLE:this.TITLE,DATINS:this.DATINS,DETAILS:this.DETAILS});$("#"+profile.list_upcoming_tickets).append(resultText)}))}else profile.hideLoadmoreTicketUpcoming(),profile.istTicketData()<=0&&(document.getElementById(profile.ticket_view_panel_empty).style.display="block")},hideLoadmoreTicketUpcoming:function(){document.getElementById(profile.btn_loadmore_upcoming_tickets).style.display="none",document.getElementById(profile.panel_loadmore_upcoming_tickets).style.display="none"},showLoadmoreTicketUpcoming:function(){document.getElementById(profile.btn_loadmore_upcoming_tickets).style.display="block",document.getElementById(profile.panel_loadmore_upcoming_tickets).style.display="block"},loadmore_events:function(e){e.stopPropagation(),e.preventDefault(),profile.firstLoad_events=!1,profile.offset_events++,event.getCalendar(this,profile.onLoadEvents,{O:profile.offset_events,d:0})},loadmore_past_events:function(e){e.stopPropagation(),e.preventDefault(),profile.firstLoadPastEvents=!1,profile.offsetPastEvents++,event.getCalendar(profile,profile.onLoadPastEvents,{O:profile.offsetPastEvents,d:1})},loadmore_channels:function(e){e.stopPropagation(),e.preventDefault(),profile.firstLoad_channels=!1,profile.offset_channels++,channel.getChannels(profile,profile.onLoadChannels,{O:profile.offset_channels})},updateHashTagUrl:function(id){history.pushState?window.history.pushState(null,null,"?a="+id):window.location.hash="?a="+id}};profile.init()}));