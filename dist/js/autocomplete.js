!function(e){"use strict";function t(e,n){var i=function(){},o=this,r={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:t.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:i,onSearchComplete:i,onSearchError:i,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!1,preventBadQueries:!0,lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(e){return"string"==typeof e?JSON.parse(e):e},forceFixPosition:!1,formatGroup:function(e){return'<div class="autocomplete-group"><strong>'+e+"</strong></div>"}};o.element=e,o.suggestions=[],o.badQueries=[],o.selectedIndex=-1,o.currentValue=o.element.value,o.intervalId=0,o.cachedResponse={},o.onChangeInterval=null,o.onChange=null,o.isLocal=!1,o.suggestionsContainer=null,o.options=s.extend({},r,n),o.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},o.hint=null,o.hintValue="",o.selection=null,o.visible=!1,o.initialize(),o.setOptions(n)}var n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},s={};s.ajax=function(e,t,n){var i=new XMLHttpRequest,o=e.headers||{},r=e.method||e.type||"GET",a="X-Requested-With",l="GET"===r?e.url+"?"+s.param(e.data):e.url;i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.responseText):n(i))},e.crossDomain||o[a]||(o[a]="XMLHttpRequest"),i.open(r,l,!0);for(var u in o)o.hasOwnProperty(u)&&i.setRequestHeader(u,o[u]);return i.send(null),i},s.ajaxAbort=function(e){e&&e.abort&&e.abort()},s.param=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&").replace(/%20/g,"+")},s.escapeRegExChars=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},s.createNode=function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t},s.hasClass=function(e,t){var n=(e.className||"").split(" ");return s.inArray(t,n)>-1},s.getData=function(e,t){return e.dataset?e.dataset[t]:e.getAttribute("data-"+t)},s.matchElement=function(e,t,n){for(var i=e.target;i;){if(s.hasClass(i,t))return i;if(!(i=i.parentNode)||i===n)return null}},s.extend=function(e){function t(e,n){var i;for(i in n)if(n.hasOwnProperty(i)){var o=n[i];e.hasOwnProperty(i)&&"object"==typeof e[i]&&s.isPlainObject(o)&&!s.isArray(o)?t(e[i],o):e[i]=o}return e}var n,i=arguments.length;for(n=1;i>n;n++)e=t(e,arguments[n]);return e},s.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},s.inArray=function(e,t){var n,s=-1,i=t.length;for(n=0;i>n;n++)if(e===t[n]){s=n;break}return s},s.toCamelCase=function(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})},s.css=function(e,t){if("string"==typeof t)return window.getComputedStyle(e).getPropertyValue(t);var n,i=e.style;for(n in t)if(t.hasOwnProperty(n)){var o=s.toCamelCase(n),r=t[n];"number"==typeof r&&s.inArray(o,["width","height","top","left","right","bottom"])>-1&&(r+="px"),i[o]=r}},s.isPlainObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},s.isFunction=function(e){return"function"==typeof e},s.noop=function(){},s.each=function(e,t){for(var n=e.length,s=0;n>s;s++)t(e[s],s)},s.removeClass=function(e,t){var n=e.className.split(" "),i=[];s.each(n,function(e){t!==e&&i.push(e)}),e.className=i.join(" ")},s.addClass=function(e,t){e.className=e.className+" "+t},s.show=function(e){e.style.display="block"},s.hide=function(e){e.style.display="none"},s.on=function(e,t,n){e.addEventListener(t,n,!1)},t.utils=s,t.formatResult=function(e,t){var n="("+s.escapeRegExChars(t)+")";return e.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>")},t.prototype={initialize:function(){function e(e){return function(t){e.call(n,t)}}var t,n=this,i=n.classes.selected,o=n.options,r=n.element;r.setAttribute("autocomplete","off"),n.killerFn=function(){n.killSuggestions(),n.disableKillerFn()},n.suggestionsContainer=s.createNode(o.containerClass),t=n.suggestionsContainer,o.appendTo.appendChild(t),"auto"!==o.width&&s.css(n.suggestionsContainer,{width:o.width}),s.on(t,"mouseover",function(e){var i=s.matchElement(e,n.classes.suggestion,t);i&&n.activate(s.getData(i,"index"))}),s.on(t,"mouseout",function(){n.selectedIndex=-1;var e=t.getElementsByClassName(i);s.each(e,function(e){s.removeClass(e,i)})}),s.on(t,"click",function(e){var i=s.matchElement(e,n.classes.suggestion,t);i&&(n.select(s.getData(i,"index")),e.stopPropagation())}),n.fixPositionCapture=function(){n.visible&&n.fixPosition()},s.on(window,"resize",n.fixPositionCapture),s.on(r,"keydown",e(n.onKeyDown)),s.on(r,"keyup",e(n.onKeyUp)),s.on(r,"change",e(n.onKeyUp)),s.on(r,"blur",e(n.onBlur)),s.on(r,"focus",e(n.onFocus))},onFocus:function(){var e=this;e.options.minChars<=e.element.value.length&&e.onValueChange(),e.fixPosition()},onBlur:function(){this.enableKillerFn()},setOptions:function(e){var t=this,n=t.options;s.extend(n,e),t.isLocal=s.isArray(n.lookup),t.isLocal&&(n.lookup=t.verifySuggestionsFormat(n.lookup)),s.css(t.suggestionsContainer,{"max-height":n.maxHeight+"px",width:n.width+"px","z-index":n.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,clearInterval(e.onChangeInterval),e.currentRequest&&(s.ajaxAbort(e.currentRequest),e.currentRequest=null)},enable:function(){this.disabled=!1},fixPosition:function(){var e=this,t=e.suggestionsContainer;if(t.parentNode===document.body){var n=e.element.offsetHeight,i={top:e.element.offsetTop,left:e.element.offsetLeft},o={top:i.top+n,left:i.left};"auto"===e.options.width&&(o.width=e.element.offsetWidth-2+"px"),s.css(t,o)}},enableKillerFn:function(){var e=this;document.addEventListener("click",e.killerFn)},disableKillerFn:function(){var e=this;document.removeEventListener("click",e.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e,t=this,n=t.element.value.length,s=t.element.selectionStart;return"number"==typeof s?s===n:!document.selection||((e=document.selection.createRange()).moveStart("character",-n),n===e.text.length)},onKeyDown:function(e){var t=this;if(t.disabled||t.visible||e.which!==n.DOWN||!t.currentValue){if(!t.disabled&&t.visible){switch(e.which){case n.ESC:t.element.value=t.currentValue,t.hide();break;case n.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case n.TAB:if(t.hint&&t.options.onHint)return void t.selectHint();if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex),!1===t.options.tabDisabled)return;break;case n.RETURN:if(-1===t.selectedIndex)return void t.hide();t.select(t.selectedIndex);break;case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}}else t.suggest()},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case n.UP:case n.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.element.value&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},changeValue:function(e){var t=this;t.element.value=e,t.onValueChange()},onValueChange:function(){var e,t=this,n=t.options,i=t.element.value,o=t.getQuery(i);return t.selection&&t.currentValue!==o&&(t.selection=null,(n.onInvalidateSelection||s.noop).call(t.element)),clearInterval(t.onChangeInterval),t.currentValue=i,t.selectedIndex=-1,n.triggerSelectOnValidInput&&-1!==(e=t.findSuggestionIndex(o))?void t.select(e):void(o.length<n.minChars?t.hide():t.getSuggestions(o))},findSuggestionIndex:function(e){var t=this,n=-1,s=e.toLowerCase();return t.suggestions.forEach(function(e,t){return e.value.toLowerCase()===s?(n=t,!1):void 0}),n},getQuery:function(e){var t,n=this.options.delimiter;return n?(t=e.split(n))[t.length-1].trim():e},getSuggestionsLocal:function(e){var t,n=this.options,s=e.toLowerCase(),i=n.lookupFilter,o=parseInt(n.lookupLimit,10);return t={suggestions:n.lookup.filter(function(t){return i(t,e,s)})},o&&t.suggestions.length>o&&(t.suggestions=t.suggestions.slice(0,o)),t},getSuggestions:function(e){var t,n,i,o,r=this,a=r.options,l=a.serviceUrl;if(a.params[a.paramName]=e,n=a.ignoreParams?null:a.params,!1!==a.onSearchStart.call(r.element,a.params)){if(s.isFunction(a.lookup))return void a.lookup(e,function(t){r.suggestions=t.suggestions,r.suggest(),a.onSearchComplete.call(r.element,e,t.suggestions)});r.isLocal?t=r.getSuggestionsLocal(e):(s.isFunction(l)&&(l=l.call(r.element,e)),i=l+"?"+s.param(n||{}),t=r.cachedResponse[i]),t&&s.isArray(t.suggestions)?(r.suggestions=t.suggestions,r.suggest(),a.onSearchComplete.call(r.element,e,t.suggestions)):r.isBadQuery(e)?a.onSearchComplete.call(r.element,e,[]):(r.currentRequest&&(s.ajaxAbort(r.currentRequest),r.currentRequest=null),o={url:l,data:n,type:a.type,dataType:a.dataType},s.extend(o,a.ajaxSettings),r.currentRequest=s.ajax(o,function(t){r.currentRequest=null;var n=a.transformResult(t);r.processResponse(n,e,i),a.onSearchComplete.call(r.element,e,n.suggestions)},function(t){a.onSearchError.call(r.element,e,t)}))}},isBadQuery:function(e){var t=this,n=t.badQueries,s=n.length;if(!t.options.preventBadQueries)return!1;for(;s--;)if(0===e.indexOf(n[s]))return!0;return!1},hide:function(){var e=this;e.visible=!1,e.selectedIndex=-1,clearInterval(e.onChangeInterval),s.hide(e.suggestionsContainer),e.signalHint(null)},suggest:function(){if(0!==this.suggestions.length){var e,t,n=this,i=n.options,o=i.groupBy,r=i.formatResult,a=n.getQuery(n.currentValue),l=n.classes.suggestion,u=n.classes.selected,c=n.suggestionsContainer,g=i.beforeRender,d="",f=function(t){var n=t.data[o];return e===n?"":(e=n,i.formatGroup(e))};return i.triggerSelectOnValidInput&&-1!==(t=n.findSuggestionIndex(a))?void n.select(t):(n.suggestions.forEach(function(e,t){o&&(d+=f(e)),d+='<div class="'+l+'" data-index="'+t+'">'+r(e,a)+"</div>"}),this.adjustContainerWidth(),c.innerHTML=d,s.isFunction(g)&&g.call(n.element,c),n.fixPosition(),s.show(c),i.autoSelectFirst&&(n.selectedIndex=0,c.scrollTop=0,s.addClass(c.firstChild,u)),n.visible=!0,void n.findBestHint())}this.hide()},adjustContainerWidth:function(){var e,t=this,n=t.options,s=t.suggestionsContainer;"auto"===n.width&&(e=t.element.offsetWidth-2,s.style.width=(e>0?e:300)+"px")},findBestHint:function(){var e=this,t=e.element.value.toLowerCase(),n=null;t&&(e.suggestions.every(function(e){var s=0===e.value.toLowerCase().indexOf(t);return s&&(n=e),!s}),e.signalHint(n))},signalHint:function(e){var t="",n=this;e&&(t=n.currentValue+e.value.substr(n.currentValue.length)),n.hintValue!==t&&(n.hintValue=t,n.hint=e,(this.options.onHint||s.noop)(t))},verifySuggestionsFormat:function(e){return e.length&&"string"==typeof e[0]?e.map(function(e){return{value:e,data:null}}):e},processResponse:function(e,t,n){var s=this,i=s.options;e.suggestions=s.verifySuggestionsFormat(e.suggestions),i.noCache||(s.cachedResponse[n]=e,i.preventBadQueries&&0===e.suggestions.length&&s.badQueries.push(t)),t===s.getQuery(s.currentValue)&&(s.suggestions=e.suggestions,s.suggest())},activate:function(e){"number"!=typeof e&&(e=parseInt(e,10));var t=this,n=t.classes.selected,i=t.suggestionsContainer,o=i.getElementsByClassName(t.classes.suggestion)[e];return s.each(i.getElementsByClassName(n),function(e){s.removeClass(e,n)}),t.selectedIndex=e,s.addClass(o,n),o},selectHint:function(){var e=this,t=s.inArray(e.hint,e.suggestions);e.select(t)},select:function(e){var t=this;t.hide(),t.onSelect(e)},moveUp:function(){var e=this;if(-1!==e.selectedIndex)return 0===e.selectedIndex?(s.removeClass(e.suggestionsContainer.children[0],e.classes.selected),e.selectedIndex=-1,e.element.value=e.currentValue,void e.findBestHint()):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var t=this,n=t.activate(e),s=n.offsetTop,i=t.suggestionsContainer.scrollTop,o=n.offsetHeight,r=i+t.options.maxHeight-o;i>s?t.suggestionsContainer.scrollTop=s:s>r&&(t.suggestionsContainer.scrollTop=s-t.options.maxHeight+o),t.element.value=t.getValue(t.suggestions[e].value),t.signalHint(null)},onSelect:function(e){var t=this,n=t.options.onSelect,i=t.suggestions[e];t.currentValue=t.getValue(i.value),t.currentValue!==t.element.value&&(t.element.value=t.currentValue),t.signalHint(null),t.suggestions=[],t.selection=i,s.isFunction(n)&&n.call(t.element,i)},getValue:function(e){var t,n,s=this,i=s.options.delimiter;return i?(t=s.currentValue,n=t.split(i),t.substr(0,t.length-n[n.length-1].length)+e):e},dispose:function(){var e=this,t=e.suggestionsContainer;e.disableKillerFn(),t.parentNode&&t.parentNode.removeChild(t)}},"function"==typeof define&&"object"==typeof define.amd&&define.amd&&define(function(){return t}),e.VanillaAutocomplete=t}(this);